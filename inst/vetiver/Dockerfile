# Generated by the vetiver package; edit with care

FROM rocker/r-ver:4.3.0
ENV RENV_CONFIG_REPOS_OVERRIDE https://packagemanager.rstudio.com/cran/latest

RUN apt-get update -qq && apt-get install -y --no-install-recommends \
  libcurl4-openssl-dev \
  libicu-dev \
  libsodium-dev \
  libssl-dev \
  make \
  zlib1g-dev \
  && apt-get clean

COPY vetiver_renv.lock renv.lock

RUN Rscript -e "install.packages('renv')"
RUN Rscript -e "renv::restore()"
RUN Rscript -e "install.packages('remotes')"

RUN apt-get install -y -q \
    build-essential \
    curl
# Get Rust; NOTE: using sh for better compatibility with other base images
RUN curl https://sh.rustup.rs -sSf | sh -s -- -y

# Add .cargo/bin to PATH
ENV PATH="/root/.cargo/bin:${PATH}"

RUN Rscript -e "remotes::install_github('josiahparry/valve', upgrade = FALSE)"

RUN export VALVE=$(Rscript -e "cat(system.file('valve', package = 'valve'))")
EXPOSE 3000
ENTRYPOINT $(Rscript -e "cat(system.file('valve', package = 'valve'))") -h "0.0.0.0"
