# Generated by the vetiver package; edit with care

FROM rocker/r-ver:4.3.0
ENV RENV_CONFIG_REPOS_OVERRIDE https://packagemanager.rstudio.com/cran/latest

RUN apt-get update -qq && apt-get install -y --no-install-recommends \
  libcurl4-openssl-dev \
  libicu-dev \
  libsodium-dev \
  libssl-dev \
  make \
  zlib1g-dev \
  && apt-get clean

COPY vetiver_renv.lock renv.lock

RUN Rscript -e "install.packages('renv')"
RUN Rscript -e "renv::restore()"


RUN apt-get install -y -q \
    build-essential \
    curl

RUN curl https://sh.rustup.rs -sSf | sh -s -- -y

ENV PATH="/root/.cargo/bin:${PATH}"
RUN cargo install --git https://github.com/josiahparry/valve/ --no-default-features


ADD cars_linear /opt/ml/cars_linear
COPY plumber.R /opt/ml/plumber.R

EXPOSE 3000
ENTRYPOINT valve -h 0.0.0.0 -f /opt/ml/plumber.R
